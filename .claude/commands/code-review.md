# 자동 코드 리뷰

PR 번호를 입력하면 변경사항을 분석하고 자동으로 코드 리뷰를 수행합니다.

## 사용 방법

```bash
/code-review 123
```

## 리뷰 프로세스

### 1단계: PR 정보 조회
- GitHub API를 통해 PR #N 정보 조회
- 제목, 설명, 변경 파일 목록 파악
- Diff 내용 분석

### 2단계: 변경사항 분석
```
## 📊 PR 분석 결과

**PR 제목**: [PR 제목]
**작성자**: [작성자]
**상태**: [상태]

**변경 통계**:
- 추가된 라인: XX줄
- 삭제된 라인: XX줄
- 수정된 파일: X개

**변경 파일**:
- [ ] file1.tsx (XX줄 변경)
- [ ] file2.ts (XX줄 변경)
- [ ] file3.md (XX줄 변경)
```

### 3단계: 코드 품질 검토
```
## ✅ 코드 품질 검토

### TypeScript & 타입 안정성
- [ ] 모든 변수에 타입 지정
- [ ] 제네릭 올바르게 사용
- [ ] any 타입 사용 최소화
- [ ] 타입 에러 없음

### 코드 스타일 & 패턴
- [ ] 프로젝트 컨벤션 준수
- [ ] 일관된 네이밍 규칙
- [ ] 복잡도 적절 (함수 길이, 순환 복잡도)
- [ ] DRY 원칙 준수

### 성능 & 최적화
- [ ] 불필요한 렌더링 없음 (React)
- [ ] API 호출 최적화
- [ ] 이미지/리소스 최적화
- [ ] 메모리 누수 없음

### 보안
- [ ] SQL Injection 방지
- [ ] XSS 취약점 없음
- [ ] CSRF 토큰 처리
- [ ] 민감 정보 노출 없음

### 테스트 & 신뢰성
- [ ] 테스트 커버리지 적절 (>80%)
- [ ] 엣지 케이스 처리
- [ ] 에러 핸들링 완벽
- [ ] 로깅 적절
```

### 4단계: 아키텍처 & 디자인 검토
```
## 🏗️ 아키텍처 검토

### 디자인 패턴
- [ ] SOLID 원칙 준수
- [ ] 적절한 디자인 패턴 사용
- [ ] 의존성 역전 원칙 준수

### 모듈 구조
- [ ] 모듈 간 의존성 적절
- [ ] 순환 의존성 없음
- [ ] 단일 책임 원칙 준수

### 재사용성
- [ ] 컴포넌트 재사용 가능성 고려
- [ ] 함수 순수성 확보
- [ ] 제네릭 활용 적절
```

### 5단계: 문서 & 유지보수성
```
## 📝 문서 & 유지보수성

### 문서화
- [ ] 함수/컴포넌트 주석 충분
- [ ] 복잡한 로직 설명 추가
- [ ] README/문서 업데이트
- [ ] API 변경사항 문서화

### 유지보수성
- [ ] 코드 가독성 우수
- [ ] 매직 넘버/스트링 제거
- [ ] 변수명 명확함
- [ ] 함수 길이 적절 (<50줄)
```

### 6단계: 종합 리뷰 의견
```
## 🎯 종합 리뷰

### 강점 (Strengths)
- ✅ [강점 1]
- ✅ [강점 2]
- ✅ [강점 3]

### 개선 사항 (Improvements Needed)
- 🔧 [개선사항 1]
  ```suggestion
  // 기존 코드
  const x = y;

  // 제안 코드
  const x = y; // 설명
  ```
- 🔧 [개선사항 2]

### 주의 사항 (Critical Issues)
- ⚠️ [주의사항 1]
- ⚠️ [주의사항 2]

### 최종 평가 (Final Assessment)
**코드 품질 점수**: X/10
- TypeScript: X/10
- 성능: X/10
- 보안: X/10
- 테스트: X/10
- 유지보수성: X/10

**승인 상태**:
- ✅ 승인 (모든 항목 통과)
- 🔄 조건부 승인 (경미한 개선 필요)
- ❌ 승인 보류 (개선 필요)

**리뷰어**: Claude Code
**리뷰 시간**: [시간]
```

### 7단계: PR에 리뷰 댓글 자동 추가

자동으로 다음 명령어 실행:
```bash
gh pr comment PR_NUMBER --body "$(cat review_result.md)"
```

결과:
- 📌 PR에 자동 코드 리뷰 댓글 추가
- 📊 구체적인 개선사항 제시
- 🎯 점수 기반 피드백
- ✅ 제안 코드 포함

## 🤖 완전 자동화 통합

`resolve-issue.md`의 8-6단계 후에 자동 실행:

```bash
# PR 생성 후 잠시 대기
sleep 3

# 자동 코드 리뷰 실행
/code-review PR_NUMBER

# 리뷰 결과가 PR 댓글로 자동 추가됨
```

## 리뷰 결과 형식

### PR 댓글 예시
```
## 🔍 Claude Code 자동 코드 리뷰

### 📊 변경사항
- 수정된 파일: 3개
- 추가된 라인: 125줄
- 삭제된 라인: 42줄

### ✅ 강점
- 타입 안전성 우수
- 테스트 커버리지 85% 달성
- 성능 최적화 적용

### 🔧 개선사항
1. **useCallback 최적화 필요**
   ```suggestion
   // Before
   const handleClick = () => { ... }

   // After
   const handleClick = useCallback(() => { ... }, [dep])
   ```

2. **에러 핸들링 추가 필요**
   ```suggestion
   try {
     await fetchData();
   } catch (error) {
     console.error('Error:', error);
     setError(error);
   }
   ```

### 🎯 최종 평가
**점수**: 8/10
**상태**: ✅ 승인 (경미한 개선 완료 권장)

**리뷰어**: Claude Code
**리뷰 시간**: 2024-11-03 18:30 UTC
```

## 사용 시나리오

### 시나리오 1: 단일 PR 리뷰
```bash
# PR #123 코드 리뷰
/code-review 123

# 결과: PR에 자동 코드 리뷰 댓글 추가
```

### 시나리오 2: 자동 통합 (resolve-issue.md)
```bash
# resolve-issue.md의 8-6단계에서 자동 호출
/code-review {PR_NUMBER}

# 순서: PR 생성 → 3초 대기 → 자동 코드 리뷰 → 댓글 추가
```

### 시나리오 3: 일괄 리뷰
```bash
# 여러 PR 동시 리뷰
for pr in 123 124 125; do
  /code-review $pr
done
```

## 주의사항

1. **PR이 존재해야 함**: 유효한 PR 번호 필수
2. **충분한 분석 시간**: 대규모 PR은 시간이 걸릴 수 있음
3. **자동 댓글 권한**: `gh pr comment` 권한 필요
4. **충돌 방지**: 중복 리뷰 주의

## 통합 장점

✨ **장점**:
- 🤖 자동 코드 리뷰로 시간 절약
- 📊 일관된 리뷰 기준 유지
- 💬 PR에 직접 댓글 추가
- 🔄 resolve-issue와 완전 통합
- 📈 코드 품질 지속적 향상
- ⏰ 야간/주말에도 자동 리뷰

---

**사용 예시**:
```bash
# Step 1: 이슈 해결 자동 시작
/sc:resolve-issue 2

# Step 2: (자동 진행)
#   - 계획 수립
#   - 코드 구현
#   - 유닛 테스트
#   - E2E 테스트
#   - PR 생성 (#123)
#   - 자동 코드 리뷰 실행
#   - 리뷰 결과 댓글 추가 ✅

# Step 3: 승인 및 병합
# PR을 검토하고 머지하면 이슈 자동 종료
```
